{"version":3,"file":"PluginState.js","sourceRoot":"","sources":["../../src/PluginState.ts"],"names":[],"mappings":"AAEA;;;;;;;;;;;;;;;;GAgBG;AACH,MAAM,OAAO,WAAW;IAStB;;;OAGG;IACH;QAVQ,iBAAY,GAAG,KAAK,CAAC;QACrB,wBAAmB,GAA0B,IAAI,CAAC;QAClD,sBAAiB,GAAG,KAAK,CAAC;QAC1B,+BAA0B,GAAG,KAAK,CAAC;QACnC,qCAAgC,GAAG,KAAK,CAAC;QAO/C,oDAAoD;IACtD,CAAC;IAED;;;;;;;;;OASG;IACI,MAAM,CAAC,WAAW;QACvB,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE,CAAC;YAC1B,WAAW,CAAC,QAAQ,GAAG,IAAI,WAAW,EAAE,CAAC;QAC3C,CAAC;QACD,OAAO,WAAW,CAAC,QAAQ,CAAC;IAC9B,CAAC;IAED;;;;OAIG;IACI,aAAa;QAClB,OAAO,IAAI,CAAC,YAAY,CAAC;IAC3B,CAAC;IAED;;;;OAIG;IACI,cAAc,CAAC,KAAc;QAClC,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;IAC5B,CAAC;IAED;;;;OAIG;IACI,qBAAqB;QAC1B,OAAO,IAAI,CAAC,mBAAmB,CAAC;IAClC,CAAC;IAED;;;;;OAKG;IACI,qBAAqB,CAAC,YAA4B;QACvD,IAAI,CAAC,mBAAmB,qBAAQ,YAAY,CAAE,CAAC;IACjD,CAAC;IAED;;;;OAIG;IACI,kBAAkB;QACvB,OAAO,IAAI,CAAC,iBAAiB,CAAC;IAChC,CAAC;IAED;;;;OAIG;IACI,mBAAmB,CAAC,KAAc;QACvC,IAAI,CAAC,iBAAiB,GAAG,KAAK,CAAC;IACjC,CAAC;IAED;;;;;;;;;;;;;;;;;;OAkBG;IACI,sBAAsB;QAC3B,IAAI,IAAI,CAAC,iBAAiB,EAAE,CAAC;YAC3B,OAAO,KAAK,CAAC;QACf,CAAC;QACD,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;QAC9B,OAAO,IAAI,CAAC;IACd,CAAC;IAED;;;;OAIG;IACI,4BAA4B;QACjC,OAAO,IAAI,CAAC,0BAA0B,CAAC;IACzC,CAAC;IAED;;;;OAIG;IACI,4BAA4B,CAAC,KAAc;QAChD,IAAI,CAAC,0BAA0B,GAAG,KAAK,CAAC;IAC1C,CAAC;IAED;;;;;OAKG;IACI,iCAAiC;QACtC,OAAO,IAAI,CAAC,gCAAgC,CAAC;IAC/C,CAAC;IAED;;;OAGG;IACI,kCAAkC,CAAC,KAAc;QACtD,IAAI,CAAC,gCAAgC,GAAG,KAAK,CAAC;IAChD,CAAC;IAED;;;OAGG;IACI,KAAK;QACV,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;QAC1B,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC;QAChC,IAAI,CAAC,iBAAiB,GAAG,KAAK,CAAC;QAC/B,IAAI,CAAC,0BAA0B,GAAG,KAAK,CAAC;QACxC,IAAI,CAAC,gCAAgC,GAAG,KAAK,CAAC;IAChD,CAAC;CACF","sourcesContent":["import type { TranslationSet } from './definitions';\n\n/**\n * Singleton class for managing plugin state.\n *\n * Ensures:\n * - Plugin is initialized before pick() is called\n * - Only one picker can be open at a time\n * - Translations are consistently available across all calls\n *\n * @example\n * ```typescript\n * const state = PluginState.getInstance();\n * state.setInitialized(true);\n * if (state.isInitialized()) {\n *   // Safe to call pick()\n * }\n * ```\n */\nexport class PluginState {\n  private static instance: PluginState;\n\n  private _initialized = false;\n  private _mergedTranslations: TranslationSet | null = null;\n  private _pickerInProgress = false;\n  private _requestPermissionsUpfront = false;\n  private _photoLibraryPermissionRequested = false;\n\n  /**\n   * Private constructor to enforce singleton pattern.\n   * Use getInstance() to access the singleton instance.\n   */\n  private constructor() {\n    // Private constructor prevents direct instantiation\n  }\n\n  /**\n   * Get the singleton instance of PluginState.\n   *\n   * @returns The singleton PluginState instance\n   *\n   * @example\n   * ```typescript\n   * const state = PluginState.getInstance();\n   * ```\n   */\n  public static getInstance(): PluginState {\n    if (!PluginState.instance) {\n      PluginState.instance = new PluginState();\n    }\n    return PluginState.instance;\n  }\n\n  /**\n   * Check if plugin has been initialized.\n   *\n   * @returns True if initialize() has been called successfully\n   */\n  public isInitialized(): boolean {\n    return this._initialized;\n  }\n\n  /**\n   * Set initialization status.\n   *\n   * @param value - True if plugin is initialized\n   */\n  public setInitialized(value: boolean): void {\n    this._initialized = value;\n  }\n\n  /**\n   * Get merged translations (defaults + custom overrides).\n   *\n   * @returns Merged translations or null if not initialized\n   */\n  public getMergedTranslations(): TranslationSet | null {\n    return this._mergedTranslations;\n  }\n\n  /**\n   * Set merged translations.\n   * Creates a defensive copy to prevent external mutation.\n   *\n   * @param translations - Complete TranslationSet with all keys\n   */\n  public setMergedTranslations(translations: TranslationSet): void {\n    this._mergedTranslations = { ...translations };\n  }\n\n  /**\n   * Check if picker is currently in progress.\n   *\n   * @returns True if pick() is currently active\n   */\n  public isPickerInProgress(): boolean {\n    return this._pickerInProgress;\n  }\n\n  /**\n   * Set picker progress status.\n   *\n   * @param value - True if picker is active\n   */\n  public setPickerInProgress(value: boolean): void {\n    this._pickerInProgress = value;\n  }\n\n  /**\n   * Atomically check and set picker progress flag.\n   * Prevents race condition where two concurrent pick() calls could both pass the check.\n   *\n   * @returns True if picker was NOT in progress and has been set to in progress.\n   *          False if picker is already in progress.\n   *\n   * @example\n   * ```typescript\n   * if (!state.trySetPickerInProgress()) {\n   *   throw new Error('picker_in_progress');\n   * }\n   * try {\n   *   // ... picker logic ...\n   * } finally {\n   *   state.setPickerInProgress(false);\n   * }\n   * ```\n   */\n  public trySetPickerInProgress(): boolean {\n    if (this._pickerInProgress) {\n      return false;\n    }\n    this._pickerInProgress = true;\n    return true;\n  }\n\n  /**\n   * Check if requestPermissionsUpfront is enabled.\n   *\n   * @returns True if permissions should be requested upfront\n   */\n  public getRequestPermissionsUpfront(): boolean {\n    return this._requestPermissionsUpfront;\n  }\n\n  /**\n   * Set requestPermissionsUpfront flag.\n   *\n   * @param value - True if permissions should be requested upfront\n   */\n  public setRequestPermissionsUpfront(value: boolean): void {\n    this._requestPermissionsUpfront = value;\n  }\n\n  /**\n   * Check if Photo Library permission has been requested.\n   * Used to prevent duplicate permission requests.\n   *\n   * @returns True if permission was already requested\n   */\n  public isPhotoLibraryPermissionRequested(): boolean {\n    return this._photoLibraryPermissionRequested;\n  }\n\n  /**\n   * Mark Photo Library permission as requested.\n   * Prevents duplicate permission requests.\n   */\n  public setPhotoLibraryPermissionRequested(value: boolean): void {\n    this._photoLibraryPermissionRequested = value;\n  }\n\n  /**\n   * Reset all state to initial values.\n   * Primarily used for testing.\n   */\n  public reset(): void {\n    this._initialized = false;\n    this._mergedTranslations = null;\n    this._pickerInProgress = false;\n    this._requestPermissionsUpfront = false;\n    this._photoLibraryPermissionRequested = false;\n  }\n}\n"]}