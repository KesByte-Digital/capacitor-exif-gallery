{"version":3,"file":"TranslationLoader.js","sourceRoot":"","sources":["../../src/TranslationLoader.ts"],"names":[],"mappings":"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","sourcesContent":["import { Device } from '@capacitor/device';\n\nimport type { SupportedLocale, TranslationSet } from './definitions';\n// Import translation files\nimport deTranslations from './translations/de.json';\nimport enTranslations from './translations/en.json';\nimport esTranslations from './translations/es.json';\nimport frTranslations from './translations/fr.json';\n\n/**\n * Translation loader utility for language detection and merging.\n *\n * Handles:\n * - System language detection via navigator.language\n * - Default translation loading\n * - Custom translation merging\n * - Validation of locale and custom keys\n *\n * @internal\n */\nexport class TranslationLoader {\n  /**\n   * All required keys in a valid TranslationSet.\n   * Used for validation of custom overrides.\n   */\n  private static readonly REQUIRED_KEYS: (keyof TranslationSet)[] = [\n    'galleryTitle',\n    'selectButton',\n    'cancelButton',\n    'selectAllButton',\n    'deselectAllButton',\n    'selectionCounter',\n    'confirmButton',\n    'filterDialogTitle',\n    'radiusLabel',\n    'startDateLabel',\n    'endDateLabel',\n    'loadingMessage',\n    'emptyMessage',\n    'errorMessage',\n    'retryButton',\n    'initializationError',\n    'permissionError',\n    'filterError',\n  ];\n\n  /**\n   * Default translations by locale.\n   */\n  private static readonly DEFAULT_TRANSLATIONS: Record<SupportedLocale, TranslationSet> = {\n    en: enTranslations as TranslationSet,\n    de: deTranslations as TranslationSet,\n    fr: frTranslations as TranslationSet,\n    es: esTranslations as TranslationSet,\n  };\n\n  /**\n   * Detect system language from navigator.language.\n   *\n   * Logic:\n   * 1. Get navigator.language (e.g., 'de-DE', 'fr-FR', 'en-US')\n   * 2. Extract language code (first 2 chars: 'de', 'fr', 'en')\n   * 3. Check if supported ('en' | 'de' | 'fr' | 'es')\n   * 4. Fallback to 'en' if not supported\n   *\n   * @returns Detected SupportedLocale, fallback to 'en'\n   *\n   * @example\n   * ```typescript\n   * // navigator.language = 'de-DE'\n   * detectSystemLanguage(); // 'de'\n   *\n   * // navigator.language = 'ja-JP' (not supported)\n   * detectSystemLanguage(); // 'en' (fallback)\n   * ```\n   */\n  public static async detectSystemLanguage(): Promise<SupportedLocale> {\n    try {\n      const deviceInfo = await Device.getLanguageCode();\n      const langCode = deviceInfo.value.split('-')[0].toLowerCase();\n\n      const supportedLocales: SupportedLocale[] = ['en', 'de', 'fr', 'es'];\n      if (supportedLocales.includes(langCode as SupportedLocale)) {\n        return langCode as SupportedLocale;\n      }\n    } catch (error) {\n      console.warn('[TranslationLoader] Failed to detect device language, falling back to English:', error);\n    }\n\n    return 'en'; // Fallback to English\n  }\n\n  /**\n   * Load default translations for a given locale.\n   *\n   * @param locale - The locale to load translations for\n   * @returns TranslationSet with all 18 keys\n   *\n   * @example\n   * ```typescript\n   * const translations = TranslationLoader.loadDefaults('de');\n   * console.log(translations.galleryTitle); // 'Bilder ausw√§hlen'\n   * ```\n   */\n  public static loadDefaults(locale: SupportedLocale): TranslationSet {\n    return { ...this.DEFAULT_TRANSLATIONS[locale] };\n  }\n\n  /**\n   * Validate that a locale is supported.\n   *\n   * @param locale - The locale to validate\n   * @throws {Error} If locale is not a SupportedLocale\n   *\n   * @example\n   * ```typescript\n   * TranslationLoader.validateLocale('en'); // OK\n   * TranslationLoader.validateLocale('ja'); // Error: Invalid locale 'ja'\n   * ```\n   */\n  public static validateLocale(locale: string): asserts locale is SupportedLocale {\n    const supportedLocales: readonly string[] = ['en', 'de', 'fr', 'es'];\n    if (!supportedLocales.includes(locale)) {\n      throw new Error(`Invalid locale '${locale}'. Supported locales: ${supportedLocales.join(', ')}`);\n    }\n  }\n\n  /**\n   * Validate that custom text keys match TranslationSet keys.\n   *\n   * @param customTexts - Partial custom overrides\n   * @throws {Error} If any key in customTexts is not a valid TranslationSet key\n   *\n   * @example\n   * ```typescript\n   * TranslationLoader.validateCustomTexts({ galleryTitle: 'Custom' }); // OK\n   * TranslationLoader.validateCustomTexts({ invalidKey: 'X' }); // Error\n   * ```\n   */\n  public static validateCustomTexts(customTexts: Partial<TranslationSet>): void {\n    const invalidKeys = Object.keys(customTexts).filter(\n      (key) => !this.REQUIRED_KEYS.includes(key as keyof TranslationSet),\n    );\n\n    if (invalidKeys.length > 0) {\n      throw new Error(\n        `Invalid customTexts keys: ${invalidKeys.join(', ')}. ` + `Valid keys: ${this.REQUIRED_KEYS.join(', ')}`,\n      );\n    }\n  }\n\n  /**\n   * Merge custom overrides on top of default translations.\n   *\n   * Creates a defensive copy to prevent mutation.\n   *\n   * @param defaults - Default TranslationSet\n   * @param customTexts - Partial custom overrides\n   * @returns Merged TranslationSet with all 18 keys\n   *\n   * @example\n   * ```typescript\n   * const defaults = TranslationLoader.loadDefaults('en');\n   * const merged = TranslationLoader.merge(defaults, {\n   *   galleryTitle: 'My Custom Title',\n   * });\n   * console.log(merged.galleryTitle); // 'My Custom Title'\n   * console.log(merged.selectButton); // 'Select' (from defaults)\n   * ```\n   */\n  public static merge(defaults: TranslationSet, customTexts?: Partial<TranslationSet>): TranslationSet {\n    if (!customTexts) {\n      return { ...defaults };\n    }\n\n    return {\n      ...defaults,\n      ...customTexts,\n    };\n  }\n\n  /**\n   * Load and merge translations based on configuration.\n   *\n   * This is the main entry point for translation loading.\n   *\n   * Logic:\n   * 1. If locale provided: validate and use it\n   * 2. Else: detect system language (fallback to 'en')\n   * 3. Load default translations for locale\n   * 4. If customTexts provided: validate and merge\n   * 5. Return merged TranslationSet\n   *\n   * @param locale - Optional explicit locale ('en' | 'de' | 'fr' | 'es')\n   * @param customTexts - Optional custom text overrides\n   * @returns Merged TranslationSet with all 18 keys\n   * @throws {Error} If locale is invalid or customTexts has invalid keys\n   *\n   * @example\n   * ```typescript\n   * // System language detection\n   * const t1 = TranslationLoader.loadTranslations();\n   *\n   * // Explicit locale\n   * const t2 = TranslationLoader.loadTranslations('de');\n   *\n   * // Explicit locale + custom overrides\n   * const t3 = TranslationLoader.loadTranslations('en', {\n   *   galleryTitle: 'Pick Photos',\n   * });\n   *\n   * // System language + custom overrides\n   * const t4 = TranslationLoader.loadTranslations(undefined, {\n   *   confirmButton: 'Done',\n   * });\n   * ```\n   */\n  public static async loadTranslations(\n    locale?: SupportedLocale,\n    customTexts?: Partial<TranslationSet>,\n  ): Promise<TranslationSet> {\n    // Determine locale to use\n    let targetLocale: SupportedLocale;\n    if (locale !== undefined) {\n      this.validateLocale(locale);\n      targetLocale = locale;\n    } else {\n      targetLocale = await this.detectSystemLanguage();\n    }\n\n    // Load default translations\n    const defaults = this.loadDefaults(targetLocale);\n\n    // Validate and merge custom overrides\n    if (customTexts !== undefined) {\n      this.validateCustomTexts(customTexts);\n      return this.merge(defaults, customTexts);\n    }\n\n    return defaults;\n  }\n}\n"]}